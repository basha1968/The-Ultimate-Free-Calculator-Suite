<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rental Property Calculator | Real Estate Investment Tool</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
    <style>
        :root {
            --primary: #2563eb;
            --primary-dark: #1d4ed8;
            --secondary: #10b981;
            --dark: #1e293b;
            --light: #f8fafc;
            --gray: #94a3b8;
            --border: #e2e8f0;
            --shadow: rgba(0, 0, 0, 0.1);
            --success: #22c55e;
            --warning: #f59e0b;
            --danger: #ef4444;
            --card-bg: #ffffff;
            --tooltip: #1e293b;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
            color: var(--dark);
            line-height: 1.6;
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            padding: 20px 0 30px;
        }

        .logo {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            margin-bottom: 10px;
        }

        .logo i {
            font-size: 32px;
            color: var(--primary);
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .logo h1 {
            font-size: 28px;
            font-weight: 700;
            color: var(--dark);
            letter-spacing: -0.5px;
        }

        .subtitle {
            color: var(--gray);
            font-size: 18px;
            max-width: 700px;
            margin: 0 auto;
        }

        .card {
            background: var(--card-bg);
            border-radius: 16px;
            box-shadow: 0 10px 25px var(--shadow);
            padding: 30px;
            margin-bottom: 25px;
            border: 1px solid var(--border);
            transition: transform 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
        }

        .card-title {
            font-size: 22px;
            font-weight: 700;
            margin-bottom: 20px;
            color: var(--dark);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .card-title i {
            color: var(--primary);
        }

        .grid-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
        }

        @media (max-width: 900px) {
            .grid-container {
                grid-template-columns: 1fr;
            }
        }

        .input-group {
            margin-bottom: 20px;
            position: relative;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--dark);
            font-size: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .info-tooltip {
            position: relative;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }

        .info-tooltip .tooltip-text {
            visibility: hidden;
            width: 250px;
            background-color: var(--tooltip);
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 10px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 14px;
            font-weight: normal;
        }

        .info-tooltip:hover .tooltip-text {
            visibility: visible;
            opacity: 1;
        }

        .input-container {
            position: relative;
        }

        .input-container i {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--gray);
        }

        input, select {
            width: 100%;
            padding: 14px 20px 14px 45px;
            border: 1px solid var(--border);
            border-radius: 12px;
            font-size: 16px;
            background: var(--light);
            transition: all 0.3s ease;
        }

        input:focus, select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        .range-container {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .range-container input[type="range"] {
            padding: 0;
            flex: 1;
        }

        .range-value {
            min-width: 60px;
            text-align: center;
            font-weight: 600;
            color: var(--primary);
            background: rgba(37, 99, 235, 0.1);
            padding: 5px 10px;
            border-radius: 8px;
        }

        .btn-group {
            display: flex;
            gap: 15px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 14px 25px;
            border-radius: 12px;
            font-weight: 600;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
            flex: 1;
        }

        .btn-primary:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: var(--light);
            color: var(--dark);
            border: 1px solid var(--border);
        }

        .btn-secondary:hover {
            background: #f1f5f9;
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-warning {
            background: var(--warning);
            color: white;
        }

        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 25px;
        }

        .result-card {
            background: var(--light);
            border-radius: 14px;
            padding: 25px;
            text-align: center;
            border: 1px solid var(--border);
            transition: all 0.3s ease;
        }

        .result-card:hover {
            transform: scale(1.03);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .result-card h3 {
            font-size: 18px;
            margin-bottom: 15px;
            color: var(--dark);
        }

        .result-value {
            font-size: 32px;
            font-weight: 800;
            margin: 10px 0;
        }

        .positive {
            color: var(--success);
        }

        .negative {
            color: var(--danger);
        }

        .neutral {
            color: var(--primary);
        }

        .result-difference {
            font-size: 18px;
            font-weight: 600;
            margin-top: 15px;
            padding: 10px;
            border-radius: 10px;
            background: rgba(16, 185, 129, 0.1);
        }

        .break-even {
            background: rgba(245, 158, 11, 0.1);
            color: var(--warning);
        }

        .chart-container {
            height: 300px;
            margin-top: 25px;
        }

        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 25px;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 5px 15px var(--shadow);
        }

        .comparison-table th {
            background: var(--primary);
            color: white;
            text-align: left;
            padding: 15px;
            font-weight: 600;
        }

        .comparison-table td {
            padding: 15px;
            border-bottom: 1px solid var(--border);
        }

        .comparison-table tr:nth-child(even) {
            background: var(--light);
        }

        .comparison-table tr:last-child td {
            border-bottom: none;
        }

        .export-section {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid var(--border);
        }

        .export-options {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .ad-container {
            background: white;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            margin: 25px 0;
            border: 1px dashed var(--border);
            color: var(--gray);
            min-height: 150px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .ad-label {
            text-transform: uppercase;
            font-size: 12px;
            letter-spacing: 1px;
            margin-bottom: 10px;
            color: var(--gray);
        }

        footer {
            text-align: center;
            padding: 30px 0;
            color: var(--gray);
            font-size: 14px;
            border-top: 1px solid var(--border);
            margin-top: 20px;
        }

        .disclaimer {
            background: rgba(239, 68, 68, 0.1);
            padding: 15px;
            border-radius: 12px;
            margin-top: 20px;
            font-size: 14px;
            color: var(--dark);
            border-left: 4px solid var(--danger);
        }

        .tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 1px solid var(--border);
            flex-wrap: wrap;
        }

        .tab {
            padding: 12px 25px;
            cursor: pointer;
            font-weight: 600;
            color: var(--gray);
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
        }

        .tab.active {
            color: var(--primary);
            border-bottom: 3px solid var(--primary);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .amortization-table {
            width: 100%;
            max-height: 400px;
            overflow-y: auto;
            display: block;
            margin-top: 20px;
        }

        .amortization-table table {
            width: 100%;
            border-collapse: collapse;
        }

        .amortization-table th {
            background: var(--primary);
            color: white;
            padding: 12px 15px;
            text-align: center;
            position: sticky;
            top: 0;
        }

        .amortization-table td {
            padding: 10px 15px;
            text-align: center;
            border-bottom: 1px solid var(--border);
        }

        .amortization-table tr:nth-child(even) {
            background-color: var(--light);
        }

        .amortization-table tr:hover {
            background-color: rgba(37, 99, 235, 0.05);
        }

        .performance-badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            margin-top: 8px;
        }

        .badge-good {
            background: rgba(16, 185, 129, 0.15);
            color: var(--success);
        }

        .badge-fair {
            background: rgba(245, 158, 11, 0.15);
            color: var(--warning);
        }

        .badge-poor {
            background: rgba(239, 68, 68, 0.15);
            color: var(--danger);
        }

        @media (max-width: 600px) {
            .btn-group {
                flex-direction: column;
            }
            
            .export-options {
                flex-direction: column;
            }
            
            .tab {
                padding: 10px 15px;
                font-size: 14px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo">
                <i class="fas fa-chart-line"></i>
                <h1>Rental Property Calculator</h1>
            </div>
            <p class="subtitle">Professional tool to analyze rental property investments and maximize returns</p>
        </header>

        <!-- Top Ad Slot -->
        <div class="ad-container">
            <div class="ad-label">Advertisement</div>
            <div class="ad-content">
                <!-- Adsterra Ad Code -->
                <div id="adsterra-top-ad" style="width: 100%; height: 100px; background: #f0f5ff; display: flex; align-items: center; justify-content: center; border-radius: 8px;">
                    <span style="color: #2563eb; font-weight: 600;">Adsterra Ad Slot (728x90)</span>
                </div>
            </div>
        </div>

        <div class="grid-container">
            <div class="card">
                <h2 class="card-title"><i class="fas fa-calculator"></i> Investment Parameters</h2>
                
                <div class="input-group">
                    <label for="purchasePrice">
                        Purchase Price ($)
                        <span class="info-tooltip">
                            <i class="fas fa-info-circle"></i>
                            <span class="tooltip-text">Total cost to acquire the property including closing costs</span>
                        </span>
                    </label>
                    <div class="input-container">
                        <i class="fas fa-home"></i>
                        <input type="number" id="purchasePrice" value="350000" min="0">
                    </div>
                </div>
                
                <div class="input-group">
                    <label for="downPayment">Down Payment (%)</label>
                    <div class="range-container">
                        <input type="range" id="downPayment" min="0" max="100" value="25" step="1">
                        <div class="range-value"><span id="downPaymentValue">25</span>%</div>
                    </div>
                </div>
                
                <div class="input-group">
                    <label for="interestRate">Mortgage Interest Rate (%)</label>
                    <div class="input-container">
                        <i class="fas fa-percentage"></i>
                        <input type="number" id="interestRate" value="5.75" min="0" max="20" step="0.01">
                    </div>
                </div>
                
                <div class="input-group">
                    <label for="loanTerm">Loan Term (years)</label>
                    <div class="input-container">
                        <i class="fas fa-calendar-alt"></i>
                        <input type="number" id="loanTerm" value="30" min="1" max="50">
                    </div>
                </div>
                
                <div class="input-group">
                    <label for="rentalIncome">Monthly Rental Income ($)</label>
                    <div class="input-container">
                        <i class="fas fa-money-bill-wave"></i>
                        <input type="number" id="rentalIncome" value="2800" min="0">
                    </div>
                </div>
                
                <div class="input-group">
                    <label for="vacancyRate">Vacancy Rate (%)</label>
                    <div class="input-container">
                        <i class="fas fa-calendar-times"></i>
                        <input type="number" id="vacancyRate" value="5" min="0" max="100" step="0.1">
                    </div>
                </div>
                
                <div class="input-group">
                    <label for="propertyTax">Annual Property Tax ($)</label>
                    <div class="input-container">
                        <i class="fas fa-landmark"></i>
                        <input type="number" id="propertyTax" value="4200" min="0">
                    </div>
                </div>
                
                <div class="input-group">
                    <label for="insurance">Annual Insurance ($)</label>
                    <div class="input-container">
                        <i class="fas fa-shield-alt"></i>
                        <input type="number" id="insurance" value="1200" min="0">
                    </div>
                </div>
                
                <div class="input-group">
                    <label for="maintenance">Annual Maintenance ($)</label>
                    <div class="input-container">
                        <i class="fas fa-tools"></i>
                        <input type="number" id="maintenance" value="1800" min="0">
                    </div>
                </div>
                
                <div class="input-group">
                    <label for="hoa">Monthly HOA Fees ($)</label>
                    <div class="input-container">
                        <i class="fas fa-building"></i>
                        <input type="number" id="hoa" value="120" min="0">
                    </div>
                </div>
                
                <div class="input-group">
                    <label for="management">Management Fees (%)</label>
                    <div class="input-container">
                        <i class="fas fa-user-tie"></i>
                        <input type="number" id="management" value="8" min="0" max="20" step="0.1">
                    </div>
                </div>
                
                <div class="input-group">
                    <label for="appreciation">Expected Appreciation (%)</label>
                    <div class="input-container">
                        <i class="fas fa-chart-line"></i>
                        <input type="number" id="appreciation" value="3.5" min="-10" max="20" step="0.1">
                    </div>
                </div>
                
                <div class="btn-group">
                    <button class="btn btn-primary" id="calculateBtn">
                        <i class="fas fa-calculator"></i> Calculate Investment
                    </button>
                    <button class="btn btn-secondary" id="resetBtn">
                        <i class="fas fa-redo"></i> Reset Values
                    </button>
                </div>
            </div>
            
            <div class="card">
                <h2 class="card-title"><i class="fas fa-chart-bar"></i> Investment Analysis</h2>
                
                <div class="tabs">
                    <div class="tab active" data-tab="summary">Summary</div>
                    <div class="tab" data-tab="amortization">Amortization</div>
                    <div class="tab" data-tab="performance">Performance</div>
                </div>
                
                <div class="tab-content active" id="summaryTab">
                    <div class="results-grid">
                        <div class="result-card">
                            <h3>Cash Flow</h3>
                            <div class="result-value positive" id="cashFlow">$423</div>
                            <p>Monthly Net Income</p>
                            <div class="performance-badge badge-good">Strong</div>
                        </div>
                        
                        <div class="result-card">
                            <h3>Cap Rate</h3>
                            <div class="result-value neutral" id="capRate">7.2%</div>
                            <p>Capitalization Rate</p>
                            <div class="performance-badge badge-good">Excellent</div>
                        </div>
                        
                        <div class="result-card">
                            <h3>ROI</h3>
                            <div class="result-value positive" id="roi">12.4%</div>
                            <p>Return on Investment</p>
                            <div class="performance-badge badge-good">Strong</div>
                        </div>
                        
                        <div class="result-card">
                            <h3>Gross Yield</h3>
                            <div class="result-value neutral" id="grossYield">9.6%</div>
                            <p>Annual Gross Yield</p>
                            <div class="performance-badge badge-fair">Good</div>
                        </div>
                    </div>
                    
                    <div class="result-difference" id="noi">
                        Net Operating Income (NOI): <strong>$15,264</strong> annually
                    </div>
                    
                    <div class="results-grid" style="margin-top: 20px;">
                        <div class="result-card">
                            <h3>Mortgage Payment</h3>
                            <div class="result-value" id="mortgagePayment">$1,532</div>
                            <p>Principal & Interest</p>
                        </div>
                        
                        <div class="result-card">
                            <h3>Total Expenses</h3>
                            <div class="result-value" id="totalExpenses">$845</div>
                            <p>Monthly Operating Costs</p>
                        </div>
                    </div>
                    
                    <div class="chart-container">
                        <canvas id="returnsChart"></canvas>
                    </div>
                </div>
                
                <div class="tab-content" id="amortizationTab">
                    <h3 class="card-title"><i class="fas fa-table"></i> Amortization Schedule (First 5 Years)</h3>
                    <div class="amortization-table">
                        <table id="amortizationTable">
                            <thead>
                                <tr>
                                    <th>Year</th>
                                    <th>Principal</th>
                                    <th>Interest</th>
                                    <th>Total Payment</th>
                                    <th>Balance</th>
                                </tr>
                            </thead>
                            <tbody id="amortizationBody">
                                <!-- Amortization data will be inserted here -->
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <div class="tab-content" id="performanceTab">
                    <h3 class="card-title"><i class="fas fa-trend-up"></i> 10-Year Projection</h3>
                    <div class="chart-container">
                        <canvas id="projectionChart"></canvas>
                    </div>
                    
                    <table class="comparison-table">
                        <thead>
                            <tr>
                                <th>Metric</th>
                                <th>Year 1</th>
                                <th>Year 5</th>
                                <th>Year 10</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Property Value</td>
                                <td>$350,000</td>
                                <td>$415,000</td>
                                <td>$490,000</td>
                            </tr>
                            <tr>
                                <td>Equity Built</td>
                                <td>$28,400</td>
                                <td>$65,200</td>
                                <td>$124,800</td>
                            </tr>
                            <tr>
                                <td>Total Cash Flow</td>
                                <td>$5,076</td>
                                <td>$28,400</td>
                                <td>$62,500</td>
                            </tr>
                            <tr>
                                <td>Total ROI</td>
                                <td>12.4%</td>
                                <td>78.2%</td>
                                <td>184.6%</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                
                <div class="export-section">
                    <h3 class="card-title"><i class="fas fa-download"></i> Export Report</h3>
                    <div class="export-options">
                        <button class="btn btn-secondary" id="printBtn">
                            <i class="fas fa-print"></i> Print Report
                        </button>
                        <button class="btn btn-secondary" id="pdfBtn">
                            <i class="fas fa-file-pdf"></i> Save as PDF
                        </button>
                        <button class="btn btn-secondary" id="excelBtn">
                            <i class="fas fa-file-excel"></i> Export to Excel
                        </button>
                        <button class="btn btn-secondary" id="shareBtn">
                            <i class="fas fa-share-alt"></i> Share Analysis
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Middle Ad Slot -->
        <div class="ad-container">
            <div class="ad-label">Advertisement</div>
            <div class="ad-content">
                <!-- Yllix Ad Code -->
                <div id="yllix-ad" style="width: 100%; height: 250px; background: #f0f5ff; display: flex; align-items: center; justify-content: center; border-radius: 8px;">
                    <span style="color: #2563eb; font-weight: 600;">Yllix Ad Slot (300x250)</span>
                </div>
            </div>
        </div>

        <div class="card">
            <h2 class="card-title"><i class="fas fa-lightbulb"></i> Investment Insights</h2>
            <div class="insights-content">
                <div class="results-grid">
                    <div class="result-card">
                        <h3>Cash on Cash ROI</h3>
                        <div class="result-value positive">12.4%</div>
                        <p>Excellent return compared to stock market average</p>
                    </div>
                    
                    <div class="result-card">
                        <h3>Break-even Point</h3>
                        <div class="result-value neutral">3.8 years</div>
                        <p>Time to recover initial investment</p>
                    </div>
                    
                    <div class="result-card">
                        <h3>DSCR</h3>
                        <div class="result-value positive">1.42</div>
                        <p>Debt Service Coverage Ratio</p>
                    </div>
                    
                    <div class="result-card">
                        <h3>Equity Build Rate</h3>
                        <div class="result-value positive">$1,840/mo</div>
                        <p>Combined principal paydown & appreciation</p>
                    </div>
                </div>
                
                <div style="margin-top: 25px;">
                    <p><strong>Recommendation:</strong> This property shows strong investment potential with healthy cash flow and excellent ROI. The 7.2% cap rate is above market average, and the 12.4% cash-on-cash return outperforms most alternative investments.</p>
                    <p style="margin-top: 15px;"><strong>Risk Factors:</strong> Consider the 5% vacancy rate assumption and potential interest rate hikes in your long-term projections. Property management at 8% is reasonable for this market.</p>
                </div>
            </div>
        </div>
        
        <div class="disclaimer">
            <strong>Disclaimer:</strong> This calculator provides estimates only. Results are based on the information you provided and may not reflect actual returns. Property appreciation, vacancy rates, and other factors are projections and not guaranteed. Consult with a financial advisor before making investment decisions.
        </div>
        
        <footer>
            <p>Â© 2023 RealEstateAnalytics Pro | Secure & Encrypted Calculations | Privacy Policy | GDPR/CCPA Compliant</p>
            <p>Your financial data is processed securely in your browser and never stored on our servers</p>
        </footer>
    </div>

    <script>
        // DOM Elements
        const calculateBtn = document.getElementById('calculateBtn');
        const resetBtn = document.getElementById('resetBtn');
        const downPaymentSlider = document.getElementById('downPayment');
        const downPaymentValue = document.getElementById('downPaymentValue');
        const tabs = document.querySelectorAll('.tab');
        const tabContents = document.querySelectorAll('.tab-content');
        const printBtn = document.getElementById('printBtn');
        const pdfBtn = document.getElementById('pdfBtn');
        const excelBtn = document.getElementById('excelBtn');
        const shareBtn = document.getElementById('shareBtn');
        let returnsChart = null;
        let projectionChart = null;

        // Initialize range slider
        downPaymentSlider.addEventListener('input', function() {
            downPaymentValue.textContent = this.value;
        });

        // Tab switching functionality
        tabs.forEach(tab => {
            tab.addEventListener('click', () => {
                // Remove active class from all tabs and contents
                tabs.forEach(t => t.classList.remove('active'));
                tabContents.forEach(c => c.classList.remove('active'));
                
                // Add active class to clicked tab
                tab.classList.add('active');
                
                // Show corresponding content
                const tabId = tab.getAttribute('data-tab');
                document.getElementById(`${tabId}Tab`).classList.add('active');
                
                // If performance tab is selected, render chart
                if(tabId === 'performance') {
                    renderProjectionChart();
                } else if(tabId === 'summary') {
                    renderReturnsChart();
                }
            });
        });

        // Calculate button event listener
        calculateBtn.addEventListener('click', calculateInvestment);

        // Reset button event listener
        resetBtn.addEventListener('click', () => {
            document.getElementById('purchasePrice').value = 350000;
            document.getElementById('downPayment').value = 25;
            downPaymentValue.textContent = 25;
            document.getElementById('interestRate').value = 5.75;
            document.getElementById('loanTerm').value = 30;
            document.getElementById('rentalIncome').value = 2800;
            document.getElementById('vacancyRate').value = 5;
            document.getElementById('propertyTax').value = 4200;
            document.getElementById('insurance').value = 1200;
            document.getElementById('maintenance').value = 1800;
            document.getElementById('hoa').value = 120;
            document.getElementById('management').value = 8;
            document.getElementById('appreciation').value = 3.5;
            
            calculateInvestment();
        });

        // Print button event listener
        printBtn.addEventListener('click', () => {
            window.print();
        });

        // Export to PDF
        pdfBtn.addEventListener('click', () => {
            alert('PDF report generated successfully! In a production environment, this would download a PDF file with your investment analysis.');
        });

        // Export to Excel
        excelBtn.addEventListener('click', () => {
            alert('Excel file exported successfully! In a production environment, this would download an Excel spreadsheet with your financial data.');
        });

        // Share functionality
        shareBtn.addEventListener('click', () => {
            alert('Share dialog opened! In a production environment, this would allow sharing via email or social media with a secure link.');
        });

        // Initial calculation on page load
        document.addEventListener('DOMContentLoaded', () => {
            calculateInvestment();
            generateAmortizationSchedule();
            renderReturnsChart();
            renderProjectionChart();
        });

        // Main calculation function
        function calculateInvestment() {
            // Get input values
            const purchasePrice = parseFloat(document.getElementById('purchasePrice').value) || 0;
            const downPaymentPercent = parseFloat(downPaymentSlider.value) || 0;
            const interestRate = parseFloat(document.getElementById('interestRate').value) || 0;
            const loanTerm = parseFloat(document.getElementById('loanTerm').value) || 0;
            const rentalIncome = parseFloat(document.getElementById('rentalIncome').value) || 0;
            const vacancyRate = parseFloat(document.getElementById('vacancyRate').value) || 0;
            const propertyTax = parseFloat(document.getElementById('propertyTax').value) || 0;
            const insurance = parseFloat(document.getElementById('insurance').value) || 0;
            const maintenance = parseFloat(document.getElementById('maintenance').value) || 0;
            const hoa = parseFloat(document.getElementById('hoa').value) || 0;
            const management = parseFloat(document.getElementById('management').value) || 0;
            const appreciation = parseFloat(document.getElementById('appreciation').value) || 0;

            // Calculate down payment amount
            const downPayment = (downPaymentPercent / 100) * purchasePrice;
            const loanAmount = purchasePrice - downPayment;

            // Calculate monthly mortgage payment
            const monthlyInterestRate = (interestRate / 100) / 12;
            const numberOfPayments = loanTerm * 12;
            const mortgagePayment = loanAmount * 
                (monthlyInterestRate * Math.pow(1 + monthlyInterestRate, numberOfPayments)) / 
                (Math.pow(1 + monthlyInterestRate, numberOfPayments) - 1);

            // Calculate vacancy and management
            const vacancy = rentalIncome * (vacancyRate / 100);
            const managementFees = rentalIncome * (management / 100);
            
            // Calculate monthly expenses
            const monthlyPropertyTax = propertyTax / 12;
            const monthlyInsurance = insurance / 12;
            const monthlyMaintenance = maintenance / 12;
            const monthlyHOAFees = hoa;
            
            // Total monthly expenses
            const totalMonthlyExpenses = vacancy + managementFees + monthlyPropertyTax + 
                                      monthlyInsurance + monthlyMaintenance + monthlyHOAFees;
            
            // Calculate net operating income (NOI)
            const noi = (rentalIncome - totalMonthlyExpenses) * 12;
            
            // Cash flow
            const cashFlow = rentalIncome - totalMonthlyExpenses - mortgagePayment;
            
            // Cap rate (annual NOI / property value)
            const capRate = (noi / purchasePrice) * 100;
            
            // Gross yield (gross annual rent / property value)
            const grossYield = (rentalIncome * 12 / purchasePrice) * 100;
            
            // ROI (annual cash flow / total investment)
            const totalInvestment = downPayment + (purchasePrice * 0.03); // 3% closing costs
            const annualCashFlow = cashFlow * 12;
            const roi = (annualCashFlow / totalInvestment) * 100;

            // Update results in UI
            document.getElementById('cashFlow').textContent = `$${Math.abs(cashFlow).toFixed(0)}`;
            document.getElementById('cashFlow').className = `result-value ${cashFlow >= 0 ? 'positive' : 'negative'}`;
            document.getElementById('capRate').textContent = `${capRate.toFixed(1)}%`;
            document.getElementById('roi').textContent = `${roi.toFixed(1)}%`;
            document.getElementById('grossYield').textContent = `${grossYield.toFixed(1)}%`;
            document.getElementById('mortgagePayment').textContent = `$${mortgagePayment.toFixed(0)}`;
            document.getElementById('totalExpenses').textContent = `$${totalMonthlyExpenses.toFixed(0)}`;
            document.getElementById('noi').innerHTML = `Net Operating Income (NOI): <strong>$${noi.toFixed(0)}</strong> annually`;
            
            // Update badges based on performance
            updatePerformanceBadges(capRate, roi, cashFlow);
            
            // Render charts
            renderReturnsChart();
            renderProjectionChart();
        }

        // Update performance badges
        function updatePerformanceBadges(capRate, roi, cashFlow) {
            const capRateBadge = document.querySelector('#summaryTab .result-card:nth-child(2) .performance-badge');
            const roiBadge = document.querySelector('#summaryTab .result-card:nth-child(3) .performance-badge');
            const cashFlowBadge = document.querySelector('#summaryTab .result-card:nth-child(1) .performance-badge');
            
            // Cap rate badges
            if (capRate >= 8) {
                capRateBadge.textContent = "Excellent";
                capRateBadge.className = "performance-badge badge-good";
            } else if (capRate >= 6) {
                capRateBadge.textContent = "Good";
                capRateBadge.className = "performance-badge badge-fair";
            } else {
                capRateBadge.textContent = "Poor";
                capRateBadge.className = "performance-badge badge-poor";
            }
            
            // ROI badges
            if (roi >= 10) {
                roiBadge.textContent = "Strong";
                roiBadge.className = "performance-badge badge-good";
            } else if (roi >= 6) {
                roiBadge.textContent = "Fair";
                roiBadge.className = "performance-badge badge-fair";
            } else {
                roiBadge.textContent = "Weak";
                roiBadge.className = "performance-badge badge-poor";
            }
            
            // Cash flow badges
            if (cashFlow >= 500) {
                cashFlowBadge.textContent = "Strong";
                cashFlowBadge.className = "performance-badge badge-good";
            } else if (cashFlow >= 200) {
                cashFlowBadge.textContent = "Good";
                cashFlowBadge.className = "performance-badge badge-fair";
            } else if (cashFlow >= 0) {
                cashFlowBadge.textContent = "Marginal";
                cashFlowBadge.className = "performance-badge badge-fair";
            } else {
                cashFlowBadge.textContent = "Negative";
                cashFlowBadge.className = "performance-badge badge-poor";
            }
        }

        // Generate amortization schedule
        function generateAmortizationSchedule() {
            const purchasePrice = parseFloat(document.getElementById('purchasePrice').value) || 350000;
            const downPaymentPercent = parseFloat(downPaymentSlider.value) || 25;
            const interestRate = parseFloat(document.getElementById('interestRate').value) || 5.75;
            const loanTerm = parseFloat(document.getElementById('loanTerm').value) || 30;
            
            const downPayment = (downPaymentPercent / 100) * purchasePrice;
            const loanAmount = purchasePrice - downPayment;
            const monthlyInterestRate = (interestRate / 100) / 12;
            const numberOfPayments = loanTerm * 12;
            const monthlyPayment = loanAmount * 
                (monthlyInterestRate * Math.pow(1 + monthlyInterestRate, numberOfPayments)) / 
                (Math.pow(1 + monthlyInterestRate, numberOfPayments) - 1);
            
            let balance = loanAmount;
            const amortizationBody = document.getElementById('amortizationBody');
            amortizationBody.innerHTML = '';
            
            // Generate first 5 years of amortization
            for (let year = 1; year <= 5; year++) {
                let yearPrincipal = 0;
                let yearInterest = 0;
                
                for (let month = 1; month <= 12; month++) {
                    const interestPayment = balance * monthlyInterestRate;
                    const principalPayment = monthlyPayment - interestPayment;
                    
                    yearPrincipal += principalPayment;
                    yearInterest += interestPayment;
                    balance -= principalPayment;
                }
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${year}</td>
                    <td>$${yearPrincipal.toFixed(0)}</td>
                    <td>$${yearInterest.toFixed(0)}</td>
                    <td>$${(yearPrincipal + yearInterest).toFixed(0)}</td>
                    <td>$${balance.toFixed(0)}</td>
                `;
                amortizationBody.appendChild(row);
            }
        }

        // Function to render the returns chart
        function renderReturnsChart() {
            const ctx = document.getElementById('returnsChart').getContext('2d');
            
            // Destroy existing chart if it exists
            if (returnsChart) {
                returnsChart.destroy();
            }
            
            // Create new chart
            returnsChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Mortgage', 'Property Tax', 'Insurance', 'Maintenance', 'HOA', 'Vacancy', 'Management'],
                    datasets: [{
                        data: [18384, 4200, 1200, 1800, 1440, 1680, 2688],
                        backgroundColor: [
                            'rgba(37, 99, 235, 0.7)',
                            'rgba(16, 185, 129, 0.7)',
                            'rgba(239, 68, 68, 0.7)',
                            'rgba(245, 158, 11, 0.7)',
                            'rgba(139, 92, 246, 0.7)',
                            'rgba(14, 165, 233, 0.7)',
                            'rgba(20, 184, 166, 0.7)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right',
                        },
                        title: {
                            display: true,
                            text: 'Annual Expense Breakdown',
                            font: {
                                size: 16
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `${context.label}: $${context.parsed.toLocaleString()} (${Math.round(context.parsed/33600*100)}%)`;
                                }
                            }
                        }
                    }
                }
            });
        }

        // Function to render the projection chart
        function renderProjectionChart() {
            const ctx = document.getElementById('projectionChart').getContext('2d');
            
            // Destroy existing chart if it exists
            if (projectionChart) {
                projectionChart.destroy();
            }
            
            // Create new chart
            projectionChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['Year 1', 'Year 2', 'Year 3', 'Year 4', 'Year 5', 'Year 6', 'Year 7', 'Year 8', 'Year 9', 'Year 10'],
                    datasets: [
                        {
                            label: 'Property Value',
                            data: [350, 365, 380, 395, 415, 432, 450, 470, 490, 510],
                            borderColor: 'rgba(37, 99, 235, 1)',
                            backgroundColor: 'rgba(37, 99, 235, 0.1)',
                            borderWidth: 3,
                            fill: true,
                            tension: 0.3
                        },
                        {
                            label: 'Equity',
                            data: [28, 42, 57, 72, 90, 110, 130, 152, 176, 200],
                            borderColor: 'rgba(16, 185, 129, 1)',
                            backgroundColor: 'rgba(16, 185, 129, 0.1)',
                            borderWidth: 3,
                            fill: true,
                            tension: 0.3
                        },
                        {
                            label: 'Cash Flow',
                            data: [5, 11, 18, 25, 33, 42, 52, 62, 73, 85],
                            borderColor: 'rgba(245, 158, 11, 1)',
                            backgroundColor: 'rgba(245, 158, 11, 0.1)',
                            borderWidth: 3,
                            fill: true,
                            tension: 0.3
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Value ($ thousands)'
                            },
                            grid: {
                                color: 'rgba(0, 0, 0, 0.05)'
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            position: 'top',
                        },
                        title: {
                            display: true,
                            text: '10-Year Investment Projection',
                            font: {
                                size: 16
                            }
                        },
                        tooltip: {
                            mode: 'index',
                            intersect: false,
                            callbacks: {
                                label: function(context) {
                                    let label = context.dataset.label || '';
                                    if (label) {
                                        label += ': ';
                                    }
                                    if (context.parsed.y !== null) {
                                        label += new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD' }).format(context.parsed.y * 1000);
                                    }
                                    return label;
                                }
                            }
                        }
                    }
                }
            });
        }
    </script>
</body>
</html>