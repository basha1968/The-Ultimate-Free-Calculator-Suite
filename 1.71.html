<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TVA Mortgage Calculator | Financial Tools Pro</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        :root {
            --primary: #2c6fbb;
            --primary-dark: #255e9d;
            --secondary: #3a8d5d;
            --success: #28a745;
            --warning: #ffc107;
            --danger: #dc3545;
            --dark: #1e1e2d;
            --light: #f8f9fa;
            --gray: #6c757d;
            --card-bg: #ffffff;
            --body-bg: #f0f5f9;
            --text: #343a40;
            --border: #d9e2ec;
            --shadow: 0 4px 15px rgba(0,0,0,0.08);
        }

        .dark-mode {
            --primary: #3a8dcd;
            --primary-dark: #2c6fbb;
            --secondary: #4caf50;
            --success: #2dce89;
            --warning: #fb6340;
            --danger: #f5365c;
            --dark: #f8f9fa;
            --light: #121a25;
            --gray: #adb5bd;
            --card-bg: #1e2835;
            --body-bg: #141c26;
            --text: #e9ecef;
            --border: #2d3846;
            --shadow: 0 4px 15px rgba(0,0,0,0.3);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: var(--body-bg);
            color: var(--text);
            transition: background-color 0.3s, color 0.3s;
            min-height: 100vh;
            padding: 20px;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 0;
            border-bottom: 1px solid var(--border);
            margin-bottom: 30px;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--primary);
        }

        .logo i {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }

        .theme-toggle {
            background: var(--card-bg);
            border: 1px solid var(--border);
            border-radius: 30px;
            padding: 8px 15px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 500;
            transition: all 0.3s;
        }

        .theme-toggle:hover {
            box-shadow: var(--shadow);
        }

        .grid-layout {
            display: grid;
            grid-template-columns: 1fr 300px;
            gap: 25px;
        }

        @media (max-width: 992px) {
            .grid-layout {
                grid-template-columns: 1fr;
            }
        }

        .calculator-card {
            background: var(--card-bg);
            border-radius: 16px;
            box-shadow: var(--shadow);
            padding: 30px;
            transition: all 0.3s;
        }

        .card-title {
            font-size: 1.5rem;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .input-group {
            margin-bottom: 20px;
            position: relative;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .input-group .tooltip {
            position: relative;
            cursor: help;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 18px;
            height: 18px;
            font-size: 0.8rem;
            border-radius: 50%;
            background: var(--border);
            color: var(--text);
        }

        .input-group .tooltip:hover::after {
            content: attr(data-tooltip);
            position: absolute;
            left: 0;
            top: 100%;
            background: var(--dark);
            color: white;
            padding: 8px 12px;
            border-radius: 4px;
            font-size: 0.85rem;
            width: 250px;
            z-index: 10;
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }

        .input-group input,
        .input-group select {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid var(--border);
            border-radius: 8px;
            background: var(--card-bg);
            color: var(--text);
            font-size: 1rem;
            transition: all 0.3s;
        }

        .input-group input:focus,
        .input-group select:focus {
            border-color: var(--primary);
            outline: none;
            box-shadow: 0 0 0 3px rgba(44, 111, 187, 0.2);
        }

        .input-row {
            display: flex;
            gap: 15px;
        }

        .input-row .input-group {
            flex: 1;
        }

        .btn {
            padding: 12px 20px;
            border-radius: 8px;
            border: none;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 1rem;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: var(--secondary);
            color: white;
        }

        .btn-secondary:hover {
            opacity: 0.9;
            transform: translateY(-2px);
        }

        .btn-group {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            margin-top: 20px;
        }

        .results-section {
            margin-top: 30px;
            padding: 25px;
            background: linear-gradient(135deg, rgba(44, 111, 187, 0.1), rgba(58, 141, 93, 0.1));
            border-radius: 12px;
            border-left: 4px solid var(--primary);
            display: none;
        }

        .result-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 15px;
        }

        .result-card {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            box-shadow: var(--shadow);
        }

        .result-card h4 {
            font-size: 1rem;
            margin-bottom: 10px;
            color: var(--gray);
        }

        .result-card p {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary);
        }

        .ad-container {
            background: rgba(0,0,0,0.05);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            margin: 25px 0;
            border: 1px dashed var(--border);
        }

        .ad-label {
            font-size: 0.9rem;
            color: var(--gray);
            margin-bottom: 10px;
            display: block;
        }

        .share-options {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 20px;
        }

        .share-btn {
            flex: 1;
            min-width: 120px;
            padding: 10px;
            background: var(--card-bg);
            border: 1px solid var(--border);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .share-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }

        .twitter { color: #1DA1F2; }
        .facebook { color: #4267B2; }
        .linkedin { color: #2867B2; }
        .email { color: var(--danger); }
        .link { color: var(--success); }

        footer {
            text-align: center;
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid var(--border);
            color: var(--gray);
            font-size: 0.9rem;
        }

        @media (max-width: 768px) {
            .input-row {
                flex-direction: column;
                gap: 15px;
            }
            
            .btn-group {
                flex-direction: column;
            }
            
            .btn-group .btn {
                width: 100%;
            }
            
            .share-btn {
                min-width: calc(50% - 10px);
            }
        }

        .ad-placeholder {
            height: 250px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(0,0,0,0.03);
            border-radius: 8px;
            color: var(--gray);
            font-weight: 500;
            text-align: center;
            padding: 20px;
            margin: 15px 0;
        }

        .ad-placeholder.interstitial {
            height: 600px;
        }

        .security-badge {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 15px;
            background: rgba(40, 167, 69, 0.1);
            border-radius: 30px;
            color: var(--success);
            margin-top: 20px;
            font-size: 0.9rem;
        }
        
        .error-message {
            color: var(--danger);
            font-size: 0.85rem;
            margin-top: 5px;
            display: none;
        }
        
        .chart-container {
            height: 250px;
            margin: 25px 0;
            position: relative;
        }
        
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 1px solid var(--border);
            padding-bottom: 10px;
        }
        
        .tab {
            padding: 8px 15px;
            border-radius: 30px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s;
            background: var(--card-bg);
            border: 1px solid var(--border);
        }
        
        .tab.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .amortization-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            overflow-x: auto;
            display: block;
        }
        
        .amortization-table th {
            background: var(--primary);
            color: white;
            text-align: left;
            padding: 10px;
            position: sticky;
            top: 0;
        }
        
        .amortization-table td {
            padding: 10px;
            border-bottom: 1px solid var(--border);
        }
        
        .amortization-table tr:nth-child(even) {
            background: rgba(0,0,0,0.03);
        }
        
        .disclaimer {
            background: rgba(255, 193, 7, 0.1);
            border-radius: 8px;
            padding: 15px;
            margin-top: 20px;
            font-size: 0.9rem;
        }
        
        .result-highlight {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 25px;
            text-align: center;
            box-shadow: var(--shadow);
            margin-top: 20px;
            border: 2px solid var(--primary);
        }
        
        .result-highlight h3 {
            color: var(--primary);
            margin-bottom: 10px;
        }
        
        .result-highlight p {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--success);
        }
        
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }
        
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--border);
            transition: .4s;
            border-radius: 24px;
        }
        
        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        
        input:checked + .toggle-slider {
            background-color: var(--primary);
        }
        
        input:checked + .toggle-slider:before {
            transform: translateX(26px);
        }
        
        .variable-rate-section {
            background: rgba(58, 141, 93, 0.1);
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .variable-rate-row {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .variable-rate-row .input-group {
            margin-bottom: 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo">
                <i class="fas fa-home"></i>
                <span>Mortgage<span style="color: var(--secondary);">Pro</span></span>
            </div>
            <div class="theme-toggle" id="themeToggle">
                <i class="fas fa-moon"></i>
                <span>Dark Mode</span>
            </div>
        </header>

        <div class="ad-container">
            <span class="ad-label">Adsterra Ad Placement (Top Banner)</span>
            <div class="ad-placeholder">
                <!-- Adsterra Ad Code would be placed here -->
                <div>
                    <i class="fas fa-ad" style="font-size: 3rem; margin-bottom: 10px; opacity: 0.3;"></i>
                    <p>Adsterra Responsive Banner Ad</p>
                    <p style="font-size: 0.8rem; margin-top: 5px;">728x90 | 300x250 | 320x50</p>
                </div>
            </div>
        </div>

        <div class="grid-layout">
            <div class="main-content">
                <div class="calculator-card">
                    <h2 class="card-title"><i class="fas fa-calculator"></i> TVA Mortgage Calculator</h2>
                    
                    <div class="input-row">
                        <div class="input-group">
                            <label for="propertyPrice">
                                <span>Property Price (€)</span>
                                <span class="tooltip" data-tooltip="Total price of the property before TVA">ⓘ</span>
                            </label>
                            <input type="number" id="propertyPrice" placeholder="Enter property price" min="10000" value="350000">
                        </div>
                        
                        <div class="input-group">
                            <label for="tvaRate">
                                <span>TVA Rate (%)</span>
                                <span class="tooltip" data-tooltip="Taxe sur la Valeur Ajoutée applicable to the property">ⓘ</span>
                            </label>
                            <input type="number" id="tvaRate" placeholder="Enter TVA rate" min="0" max="30" step="0.1" value="20">
                        </div>
                    </div>
                    
                    <div class="input-row">
                        <div class="input-group">
                            <label for="downPayment">
                                <span>Down Payment (€)</span>
                                <span class="tooltip" data-tooltip="Initial payment made when purchasing the property">ⓘ</span>
                            </label>
                            <input type="number" id="downPayment" placeholder="Enter down payment" min="0" value="70000">
                        </div>
                        
                        <div class="input-group">
                            <label for="loanTerm">
                                <span>Loan Term (Years)</span>
                                <span class="tooltip" data-tooltip="Duration of the mortgage in years">ⓘ</span>
                            </label>
                            <input type="number" id="loanTerm" placeholder="Enter loan term" min="1" max="40" value="25">
                        </div>
                    </div>
                    
                    <div class="input-row">
                        <div class="input-group">
                            <label for="interestType">
                                <span>Interest Type</span>
                                <span class="tooltip" data-tooltip="Select fixed or variable interest rate">ⓘ</span>
                            </label>
                            <select id="interestType">
                                <option value="fixed" selected>Fixed Rate</option>
                                <option value="variable">Variable Rate</option>
                            </select>
                        </div>
                        
                        <div class="input-group">
                            <label for="interestRate">
                                <span>Interest Rate (%)</span>
                                <span class="tooltip" data-tooltip="Annual interest rate for your mortgage">ⓘ</span>
                            </label>
                            <input type="number" id="interestRate" placeholder="Enter interest rate" min="0.1" step="0.01" value="3.75">
                        </div>
                    </div>
                    
                    <div class="variable-rate-section" id="variableRateSection" style="display: none;">
                        <h3><i class="fas fa-chart-line"></i> Variable Rate Options</h3>
                        
                        <div class="variable-rate-row">
                            <div class="input-group">
                                <label for="initialRatePeriod">
                                    <span>Initial Rate Period (Years)</span>
                                    <span class="tooltip" data-tooltip="Duration of the initial fixed interest period">ⓘ</span>
                                </label>
                                <input type="number" id="initialRatePeriod" placeholder="Enter years" min="1" max="10" value="5">
                            </div>
                            
                            <div class="input-group">
                                <label for="subsequentRate">
                                    <span>Subsequent Rate (%)</span>
                                    <span class="tooltip" data-tooltip="Interest rate after the initial fixed period">ⓘ</span>
                                </label>
                                <input type="number" id="subsequentRate" placeholder="Enter rate" min="0.1" step="0.01" value="4.25">
                            </div>
                        </div>
                    </div>
                    
                    <div class="btn-group">
                        <button class="btn btn-primary" id="calculateBtn">
                            <i class="fas fa-calculator"></i> Calculate Mortgage
                        </button>
                        <button class="btn" id="resetBtn" style="background: var(--card-bg); color: var(--text); border: 1px solid var(--border);">
                            <i class="fas fa-redo"></i> Reset
                        </button>
                    </div>
                    
                    <div class="results-section" id="resultsSection">
                        <div class="result-highlight">
                            <h3>Your Monthly Payment</h3>
                            <p id="monthlyPayment">€1,325</p>
                        </div>
                        
                        <div class="result-grid">
                            <div class="result-card">
                                <h4>Total Loan Amount</h4>
                                <p id="totalLoan">€350,000</p>
                            </div>
                            <div class="result-card">
                                <h4>Total TVA Paid</h4>
                                <p id="totalTVA">€70,000</p>
                            </div>
                            <div class="result-card">
                                <h4>Total Interest Paid</h4>
                                <p id="totalInterest">€147,500</p>
                            </div>
                            <div class="result-card">
                                <h4>Total Cost</h4>
                                <p id="totalCost">€567,500</p>
                            </div>
                        </div>
                        
                        <div class="chart-container">
                            <canvas id="mortgageChart"></canvas>
                        </div>
                        
                        <div class="tabs">
                            <div class="tab active" data-tab="summary">Summary</div>
                            <div class="tab" data-tab="amortization">Amortization Schedule</div>
                            <div class="tab" data-tab="tva">TVA Breakdown</div>
                        </div>
                        
                        <div class="tab-content active" id="summaryTab">
                            <h3><i class="fas fa-file-invoice-dollar"></i> Mortgage Summary</h3>
                            <div class="result-grid">
                                <div class="result-card">
                                    <h4>Property Price</h4>
                                    <p id="resultPropertyPrice">€350,000</p>
                                </div>
                                <div class="result-card">
                                    <h4>Down Payment</h4>
                                    <p id="resultDownPayment">€70,000</p>
                                </div>
                                <div class="result-card">
                                    <h4>Loan Amount</h4>
                                    <p id="resultLoanAmount">€280,000</p>
                                </div>
                                <div class="result-card">
                                    <h4>TVA Amount</h4>
                                    <p id="resultTvaAmount">€70,000</p>
                                </div>
                            </div>
                            
                            <div class="result-grid">
                                <div class="result-card">
                                    <h4>Interest Rate</h4>
                                    <p id="resultInterestRate">3.75%</p>
                                </div>
                                <div class="result-card">
                                    <h4>Loan Term</h4>
                                    <p id="resultLoanTerm">25 years</p>
                                </div>
                                <div class="result-card">
                                    <h4>Payoff Date</h4>
                                    <p id="payoffDate">June 2048</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="tab-content" id="amortizationTab">
                            <h3><i class="fas fa-table"></i> Amortization Schedule</h3>
                            <p>Breakdown of principal and interest payments over the loan term</p>
                            
                            <div style="max-height: 300px; overflow-y: auto; margin-top: 15px;">
                                <table class="amortization-table">
                                    <thead>
                                        <tr>
                                            <th>Year</th>
                                            <th>Principal Paid</th>
                                            <th>Interest Paid</th>
                                            <th>Total Paid</th>
                                            <th>Remaining Balance</th>
                                        </tr>
                                    </thead>
                                    <tbody id="amortizationBody">
                                        <!-- Amortization data will be inserted here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        
                        <div class="tab-content" id="tvaTab">
                            <h3><i class="fas fa-percent"></i> TVA Breakdown</h3>
                            <p>Detailed analysis of TVA impact on your mortgage</p>
                            
                            <div class="result-grid">
                                <div class="result-card">
                                    <h4>Property Price (excl. TVA)</h4>
                                    <p id="tvaExclPrice">€350,000</p>
                                </div>
                                <div class="result-card">
                                    <h4>TVA Amount</h4>
                                    <p id="tvaAmount">€70,000</p>
                                </div>
                                <div class="result-card">
                                    <h4>Total Price (incl. TVA)</h4>
                                    <p id="tvaInclPrice">€420,000</p>
                                </div>
                            </div>
                            
                            <div class="chart-container">
                                <canvas id="tvaChart"></canvas>
                            </div>
                        </div>
                        
                        <h3 style="margin-top: 30px;"><i class="fas fa-share-alt"></i> Export & Share</h3>
                        <div class="btn-group">
                            <button class="btn" id="printBtn">
                                <i class="fas fa-print"></i> Print
                            </button>
                            <button class="btn" id="pdfBtn">
                                <i class="fas fa-file-pdf"></i> PDF
                            </button>
                            <button class="btn" id="excelBtn">
                                <i class="fas fa-file-excel"></i> Excel
                            </button>
                            <button class="btn" id="csvBtn">
                                <i class="fas fa-file-csv"></i> CSV
                            </button>
                        </div>
                        
                        <div class="share-options">
                            <div class="share-btn twitter" id="twitterBtn">
                                <i class="fab fa-twitter"></i> Twitter
                            </div>
                            <div class="share-btn facebook" id="facebookBtn">
                                <i class="fab fa-facebook"></i> Facebook
                            </div>
                            <div class="share-btn linkedin" id="linkedinBtn">
                                <i class="fab fa-linkedin"></i> LinkedIn
                            </div>
                            <div class="share-btn email" id="emailBtn">
                                <i class="fas fa-envelope"></i> Email
                            </div>
                            <div class="share-btn link" id="copyLinkBtn">
                                <i class="fas fa-link"></i> Copy Link
                            </div>
                        </div>
                    </div>
                    
                    <div class="disclaimer">
                        <i class="fas fa-shield-alt"></i> 
                        <strong>Security & Compliance:</strong> All calculations are performed securely in your browser. 
                        No personal or financial data is transmitted to or stored on any servers. 
                        This tool complies with GDPR and financial data protection standards.
                    </div>
                </div>
            </div>
            
            <div class="sidebar">
                <div class="calculator-card">
                    <h2 class="card-title"><i class="fas fa-money-bill-wave"></i> Monetization</h2>
                    
                    <div class="ad-container">
                        <span class="ad-label">Adsterra Ad Placement (Sidebar)</span>
                        <div class="ad-placeholder interstitial">
                            <!-- Adsterra Ad Code would be placed here -->
                            <div>
                                <i class="fas fa-ad" style="font-size: 3rem; margin-bottom: 10px; opacity: 0.3;"></i>
                                <p>Adsterra Sidebar Banner</p>
                                <p style="font-size: 0.8rem; margin-top: 5px;">300x600 | 160x600 | 120x600</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="ad-container" style="margin-top: 25px;">
                        <span class="ad-label">Yllix Ad Placement (In-Content)</span>
                        <div class="ad-placeholder">
                            <!-- Yllix Ad Code would be placed here -->
                            <div>
                                <i class="fas fa-ad" style="font-size: 3rem; margin-bottom: 10px; opacity: 0.3;"></i>
                                <p>Yllix Native Ad</p>
                                <p style="font-size: 0.8rem; margin-top: 5px;">300x250 | 336x280 | 320x50</p>
                            </div>
                        </div>
                    </div>
                    
                    <h3 style="margin-top: 20px;"><i class="fas fa-lightbulb"></i> Mortgage Tips</h3>
                    <ul style="padding-left: 20px; margin: 15px 0;">
                        <li>Consider making extra payments to reduce interest costs</li>
                        <li>Review your mortgage terms annually</li>
                        <li>Understand how TVA impacts your total purchase price</li>
                        <li>Shop around for the best interest rates</li>
                    </ul>
                    
                    <div class="security-badge">
                        <i class="fas fa-user-shield"></i>
                        <span>This calculator complies with financial regulations and protects your privacy.</span>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="ad-container">
            <span class="ad-label">Yllix Ad Placement (Footer)</span>
            <div class="ad-placeholder">
                <!-- Yllix Ad Code would be placed here -->
                <div>
                    <i class="fas fa-ad" style="font-size: 3rem; margin-bottom: 10px; opacity: 0.3;"></i>
                    <p>Yllix Footer Banner</p>
                    <p style="font-size: 0.8rem; margin-top: 5px;">728x90 | 300x250 | 320x50</p>
                </div>
            </div>
        </div>
        
        <footer>
            <p>© 2023 TVA Mortgage Calculator | All calculations performed client-side for maximum security</p>
            <p style="margin-top: 8px;">This tool provides estimates only. Consult a financial advisor for personalized advice.</p>
        </footer>
    </div>

    <script>
        // DOM Elements
        const themeToggle = document.getElementById('themeToggle');
        const calculateBtn = document.getElementById('calculateBtn');
        const resetBtn = document.getElementById('resetBtn');
        const resultsSection = document.getElementById('resultsSection');
        const propertyPriceInput = document.getElementById('propertyPrice');
        const tvaRateInput = document.getElementById('tvaRate');
        const downPaymentInput = document.getElementById('downPayment');
        const loanTermInput = document.getElementById('loanTerm');
        const interestTypeSelect = document.getElementById('interestType');
        const interestRateInput = document.getElementById('interestRate');
        const variableRateSection = document.getElementById('variableRateSection');
        const initialRatePeriodInput = document.getElementById('initialRatePeriod');
        const subsequentRateInput = document.getElementById('subsequentRate');
        const tabs = document.querySelectorAll('.tab');
        const tabContents = document.querySelectorAll('.tab-content');
        
        // Result elements
        const monthlyPayment = document.getElementById('monthlyPayment');
        const totalLoan = document.getElementById('totalLoan');
        const totalTVA = document.getElementById('totalTVA');
        const totalInterest = document.getElementById('totalInterest');
        const totalCost = document.getElementById('totalCost');
        const resultPropertyPrice = document.getElementById('resultPropertyPrice');
        const resultDownPayment = document.getElementById('resultDownPayment');
        const resultLoanAmount = document.getElementById('resultLoanAmount');
        const resultTvaAmount = document.getElementById('resultTvaAmount');
        const resultInterestRate = document.getElementById('resultInterestRate');
        const resultLoanTerm = document.getElementById('resultLoanTerm');
        const payoffDate = document.getElementById('payoffDate');
        const tvaExclPrice = document.getElementById('tvaExclPrice');
        const tvaAmount = document.getElementById('tvaAmount');
        const tvaInclPrice = document.getElementById('tvaInclPrice');
        const amortizationBody = document.getElementById('amortizationBody');
        
        // Initialize Charts
        let mortgageChart, tvaChart;

        // Theme Toggle
        themeToggle.addEventListener('click', () => {
            document.body.classList.toggle('dark-mode');
            const isDarkMode = document.body.classList.contains('dark-mode');
            themeToggle.innerHTML = isDarkMode 
                ? '<i class="fas fa-sun"></i> <span>Light Mode</span>' 
                : '<i class="fas fa-moon"></i> <span>Dark Mode</span>';
            
            // Re-render charts on theme change
            renderCharts();
        });

        // Interest Type Toggle
        interestTypeSelect.addEventListener('change', () => {
            if (interestTypeSelect.value === 'variable') {
                variableRateSection.style.display = 'block';
            } else {
                variableRateSection.style.display = 'none';
            }
        });

        // Tab Switching
        tabs.forEach(tab => {
            tab.addEventListener('click', () => {
                // Remove active class from all tabs
                tabs.forEach(t => t.classList.remove('active'));
                tabContents.forEach(tc => tc.classList.remove('active'));
                
                // Add active class to clicked tab
                tab.classList.add('active');
                const tabId = tab.getAttribute('data-tab') + 'Tab';
                document.getElementById(tabId).classList.add('active');
            });
        });

        // Calculate Mortgage
        function calculateMortgage() {
            const propertyPrice = parseFloat(propertyPriceInput.value) || 350000;
            const tvaRate = parseFloat(tvaRateInput.value) || 20;
            const downPayment = parseFloat(downPaymentInput.value) || 70000;
            const loanTerm = parseFloat(loanTermInput.value) || 25;
            const interestType = interestTypeSelect.value;
            let interestRate = parseFloat(interestRateInput.value) || 3.75;
            
            // Calculate TVA and total price
            const tvaAmountValue = propertyPrice * (tvaRate / 100);
            const totalPrice = propertyPrice + tvaAmountValue;
            
            // Loan amount (total price minus down payment)
            const loanAmount = totalPrice - downPayment;
            
            // For variable rate mortgages
            let initialRatePeriod = 0;
            let subsequentRate = interestRate;
            
            if (interestType === 'variable') {
                initialRatePeriod = parseFloat(initialRatePeriodInput.value) || 5;
                subsequentRate = parseFloat(subsequentRateInput.value) || 4.25;
            }
            
            // Calculate monthly payment
            const monthlyRate = interestRate / 100 / 12;
            const totalPayments = loanTerm * 12;
            let monthlyPaymentValue = 0;
            
            if (interestType === 'fixed') {
                monthlyPaymentValue = (loanAmount * monthlyRate) / (1 - Math.pow(1 + monthlyRate, -totalPayments));
            } else {
                // Variable rate calculation
                const initialPayments = initialRatePeriod * 12;
                const subsequentPayments = totalPayments - initialPayments;
                
                // Calculate initial payment
                const initialMonthlyRate = interestRate / 100 / 12;
                const initialMonthlyPayment = (loanAmount * initialMonthlyRate) / (1 - Math.pow(1 + initialMonthlyRate, -totalPayments));
                
                // Calculate balance after initial period
                let balance = loanAmount;
                for (let i = 0; i < initialPayments; i++) {
                    const interest = balance * initialMonthlyRate;
                    const principal = initialMonthlyPayment - interest;
                    balance -= principal;
                }
                
                // Calculate subsequent payment
                const subsequentMonthlyRate = subsequentRate / 100 / 12;
                monthlyPaymentValue = (balance * subsequentMonthlyRate) / (1 - Math.pow(1 + subsequentMonthlyRate, -subsequentPayments));
            }
            
            // Calculate total interest
            let totalInterestValue = 0;
            let balance = loanAmount;
            const amortizationData = [];
            
            for (let year = 1; year <= loanTerm; year++) {
                let yearlyInterest = 0;
                let yearlyPrincipal = 0;
                
                for (let month = 1; month <= 12; month++) {
                    const monthlyInterest = balance * (interestRate / 100 / 12);
                    const monthlyPrincipal = monthlyPaymentValue - monthlyInterest;
                    
                    yearlyInterest += monthlyInterest;
                    yearlyPrincipal += monthlyPrincipal;
                    balance -= monthlyPrincipal;
                }
                
                amortizationData.push({
                    year,
                    principal: yearlyPrincipal,
                    interest: yearlyInterest,
                    total: yearlyPrincipal + yearlyInterest,
                    balance
                });
                
                totalInterestValue += yearlyInterest;
            }
            
            // Total cost
            const totalCostValue = loanAmount + totalInterestValue + tvaAmountValue;
            
            // Payoff date
            const currentDate = new Date();
            const payoffDateValue = new Date(currentDate);
            payoffDateValue.setFullYear(payoffDateValue.getFullYear() + loanTerm);
            
            // Update results
            monthlyPayment.textContent = '€' + formatNumber(monthlyPaymentValue.toFixed(0));
            totalLoan.textContent = '€' + formatNumber(loanAmount);
            totalTVA.textContent = '€' + formatNumber(tvaAmountValue);
            totalInterest.textContent = '€' + formatNumber(totalInterestValue.toFixed(0));
            totalCost.textContent = '€' + formatNumber(totalCostValue.toFixed(0));
            
            resultPropertyPrice.textContent = '€' + formatNumber(propertyPrice);
            resultDownPayment.textContent = '€' + formatNumber(downPayment);
            resultLoanAmount.textContent = '€' + formatNumber(loanAmount);
            resultTvaAmount.textContent = '€' + formatNumber(tvaAmountValue);
            resultInterestRate.textContent = interestRate + '%';
            resultLoanTerm.textContent = loanTerm + ' years';
            payoffDate.textContent = payoffDateValue.toLocaleString('default', { month: 'long', year: 'numeric' });
            
            tvaExclPrice.textContent = '€' + formatNumber(propertyPrice);
            tvaAmount.textContent = '€' + formatNumber(tvaAmountValue);
            tvaInclPrice.textContent = '€' + formatNumber(totalPrice);
            
            // Update amortization table
            amortizationBody.innerHTML = '';
            amortizationData.forEach(data => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${data.year}</td>
                    <td>€${formatNumber(data.principal.toFixed(0))}</td>
                    <td>€${formatNumber(data.interest.toFixed(0))}</td>
                    <td>€${formatNumber(data.total.toFixed(0))}</td>
                    <td>€${formatNumber(data.balance.toFixed(0))}</td>
                `;
                amortizationBody.appendChild(row);
            });
            
            // Show results section
            resultsSection.style.display = 'block';
            
            // Render charts
            renderCharts(propertyPrice, tvaAmountValue, loanAmount, totalInterestValue);
        }

        // Format number with commas
        function formatNumber(num) {
            return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
        }

        // Render Charts
        function renderCharts(propertyPrice = 350000, tvaAmount = 70000, loanAmount = 280000, totalInterest = 147500) {
            const mortgageCtx = document.getElementById('mortgageChart').getContext('2d');
            const tvaCtx = document.getElementById('tvaChart').getContext('2d');
            
            // Destroy previous charts if they exist
            if (mortgageChart) mortgageChart.destroy();
            if (tvaChart) tvaChart.destroy();
            
            // Mortgage composition chart
            mortgageChart = new Chart(mortgageCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Property Value', 'TVA', 'Total Interest'],
                    datasets: [{
                        data: [propertyPrice, tvaAmount, totalInterest],
                        backgroundColor: [
                            'rgba(44, 111, 187, 0.7)',
                            'rgba(58, 141, 93, 0.7)',
                            'rgba(220, 53, 69, 0.7)'
                        ],
                        borderColor: [
                            'rgba(44, 111, 187, 1)',
                            'rgba(58, 141, 93, 1)',
                            'rgba(220, 53, 69, 1)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                color: document.body.classList.contains('dark-mode') ? '#e9ecef' : '#343a40'
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const label = context.label || '';
                                    const value = context.raw || 0;
                                    const total = context.chart.getDatasetMeta(0).total;
                                    const percentage = Math.round((value / total) * 100);
                                    return `${label}: €${formatNumber(value.toFixed(0))} (${percentage}%)`;
                                }
                            }
                        }
                    }
                }
            });
            
            // TVA breakdown chart
            tvaChart = new Chart(tvaCtx, {
                type: 'pie',
                data: {
                    labels: ['Property Price (excl. TVA)', 'TVA Amount'],
                    datasets: [{
                        data: [propertyPrice, tvaAmount],
                        backgroundColor: [
                            'rgba(44, 111, 187, 0.7)',
                            'rgba(58, 141, 93, 0.7)'
                        ],
                        borderColor: [
                            'rgba(44, 111, 187, 1)',
                            'rgba(58, 141, 93, 1)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                color: document.body.classList.contains('dark-mode') ? '#e9ecef' : '#343a40'
                            }
                        }
                    }
                }
            });
        }

        // Reset Form
        function resetForm() {
            propertyPriceInput.value = '350000';
            tvaRateInput.value = '20';
            downPaymentInput.value = '70000';
            loanTermInput.value = '25';
            interestTypeSelect.value = 'fixed';
            interestRateInput.value = '3.75';
            initialRatePeriodInput.value = '5';
            subsequentRateInput.value = '4.25';
            variableRateSection.style.display = 'none';
            resultsSection.style.display = 'none';
        }

        // Export Functions
        function exportPDF() {
            alert('PDF export would generate a detailed mortgage report. In a real app, this would use jsPDF to create a professional PDF document.');
        }

        function exportExcel() {
            alert('Excel export would generate a spreadsheet with your mortgage details. In a real app, this would use SheetJS to create an Excel file.');
        }

        function exportCSV() {
            alert('CSV export would generate a CSV file with your amortization schedule. In a real app, this would create a downloadable CSV.');
        }

        function printResults() {
            alert('Print functionality would open a printer-friendly view. In a real app, this would generate a printable report.');
        }

        // Share Functions
        function shareOnTwitter() {
            const text = `I used MortgagePro to calculate my TVA mortgage. Estimate your mortgage costs: ${window.location.href}`;
            const url = `https://twitter.com/intent/tweet?text=${encodeURIComponent(text)}`;
            window.open(url, '_blank');
        }

        function shareOnFacebook() {
            const url = `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(window.location.href)}`;
            window.open(url, '_blank');
        }

        function shareOnLinkedIn() {
            const url = `https://www.linkedin.com/shareArticle?mini=true&url=${encodeURIComponent(window.location.href)}&title=TVA%20Mortgage%20Calculator`;
            window.open(url, '_blank');
        }

        function shareViaEmail() {
            const subject = 'My TVA Mortgage Calculation';
            const body = `I used MortgagePro to estimate my mortgage costs. Check it out: ${window.location.href}`;
            window.location.href = `mailto:?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
        }

        function copyLink() {
            navigator.clipboard.writeText(window.location.href);
            alert('Secure link copied to clipboard!');
        }

        // Event Listeners
        calculateBtn.addEventListener('click', calculateMortgage);
        resetBtn.addEventListener('click', resetForm);
        document.getElementById('printBtn').addEventListener('click', printResults);
        document.getElementById('pdfBtn').addEventListener('click', exportPDF);
        document.getElementById('excelBtn').addEventListener('click', exportExcel);
        document.getElementById('csvBtn').addEventListener('click', exportCSV);
        document.getElementById('twitterBtn').addEventListener('click', shareOnTwitter);
        document.getElementById('facebookBtn').addEventListener('click', shareOnFacebook);
        document.getElementById('linkedinBtn').addEventListener('click', shareOnLinkedIn);
        document.getElementById('emailBtn').addEventListener('click', shareViaEmail);
        document.getElementById('copyLinkBtn').addEventListener('click', copyLink);

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            // Calculate on initial load
            calculateMortgage();
        });
    </script>
</body>
</html>