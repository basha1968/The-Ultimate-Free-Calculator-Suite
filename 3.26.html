<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Professional IP Subnet Calculator</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        :root {
            --primary: #2c3e50;
            --secondary: #3498db;
            --accent: #e74c3c;
            --success: #2ecc71;
            --warning: #f39c12;
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            --border-radius: 10px;
            --transition: all 0.3s ease;
            
            --bg-color: #f8f9fa;
            --text-color: #333;
            --card-bg: #ffffff;
            --input-bg: #ffffff;
            --border-color: #ddd;
            --result-bg: #f0f8ff;
            --feature-bg: #ffffff;
            --footer-bg: #f1f1f1;
            --footer-text: #666;
            --ad-bg: #f9f9f9;
        }

        .dark-mode {
            --bg-color: #1a2a4c;
            --text-color: #ecf0f1;
            --card-bg: rgba(44, 62, 80, 0.8);
            --input-bg: rgba(0, 0, 0, 0.2);
            --border-color: rgba(52, 152, 219, 0.3);
            --result-bg: rgba(0, 0, 0, 0.3);
            --feature-bg: rgba(44, 62, 80, 0.7);
            --footer-bg: rgba(44, 62, 80, 0.9);
            --footer-text: #95a5a6;
            --ad-bg: rgba(0, 0, 0, 0.2);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease;
        }
        
        body {
            background: var(--bg-color);
            color: var(--text-color);
            min-height: 100vh;
            padding: 20px;
            line-height: 1.6;
            transition: background-color 0.3s ease;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: 1fr;
            gap: 25px;
        }
        
        header {
            text-align: center;
            padding: 20px 0;
            animation: fadeIn 1s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
            margin-bottom: 20px;
        }
        
        .theme-toggle {
            background: var(--secondary);
            color: white;
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: var(--shadow);
            transition: var(--transition);
        }
        
        .theme-toggle:hover {
            transform: rotate(30deg);
            background: var(--accent);
        }
        
        header h1 {
            font-size: 2.8rem;
            margin-bottom: 10px;
            background: linear-gradient(to right, #3498db, #2ecc71);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }
        
        header p {
            font-size: 1.2rem;
            max-width: 800px;
            margin: 0 auto 20px;
            color: var(--footer-text);
        }
        
        .calculator-card {
            background: var(--card-bg);
            backdrop-filter: blur(10px);
            border-radius: var(--border-radius);
            padding: 30px;
            box-shadow: var(--shadow);
            animation: slideUp 0.8s ease;
            border: 1px solid var(--border-color);
        }
        
        .calculator-title {
            text-align: center;
            margin-bottom: 25px;
            color: var(--secondary);
            font-size: 1.8rem;
            position: relative;
            padding-bottom: 15px;
        }
        
        .calculator-title::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 80px;
            height: 3px;
            background: linear-gradient(to right, #3498db, #2ecc71);
            border-radius: 3px;
        }
        
        .input-row {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .input-group {
            flex: 1;
            min-width: 250px;
        }
        
        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--text-color);
        }
        
        .input-group input, 
        .input-group select {
            width: 100%;
            padding: 14px;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            background: var(--input-bg);
            color: var(--text-color);
            font-size: 1.1rem;
            transition: var(--transition);
        }
        
        .input-group input:focus,
        .input-group select:focus {
            outline: none;
            border-color: var(--secondary);
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
        }
        
        .input-group input::placeholder {
            color: #95a5a6;
        }
        
        .result-container {
            background: var(--result-bg);
            padding: 25px;
            border-radius: var(--border-radius);
            margin: 25px 0;
            border: 1px solid var(--border-color);
            position: relative;
            overflow: hidden;
        }
        
        .result-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(to right, #3498db, #2ecc71);
        }
        
        .result-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .result-item {
            background: rgba(52, 152, 219, 0.1);
            border-radius: 8px;
            padding: 15px;
            border: 1px solid rgba(52, 152, 219, 0.2);
        }
        
        .result-label {
            font-size: 1rem;
            color: var(--footer-text);
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .result-value {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--secondary);
            word-break: break-all;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .copy-btn {
            background: rgba(52, 152, 219, 0.2);
            border: none;
            border-radius: 4px;
            padding: 5px 10px;
            cursor: pointer;
            transition: var(--transition);
            color: var(--text-color);
        }
        
        .copy-btn:hover {
            background: var(--secondary);
            color: white;
        }
        
        .action-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 30px 0;
        }
        
        .btn {
            padding: 14px 20px;
            border: none;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .btn-primary {
            background: linear-gradient(to right, #3498db, #2980b9);
            color: white;
        }
        
        .btn-secondary {
            background: var(--feature-bg);
            color: var(--text-color);
            border: 2px solid var(--secondary);
        }
        
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2);
        }
        
        .btn:active {
            transform: translateY(-1px);
        }
        
        .btn i {
            font-size: 1.2rem;
        }
        
        .ad-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        
        .ad-box {
            background: var(--ad-bg);
            border-radius: var(--border-radius);
            padding: 20px;
            text-align: center;
            border: 1px solid var(--border-color);
        }
        
        .ad-label {
            color: var(--warning);
            font-weight: 600;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .ad-content {
            height: 250px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(0, 0, 0, 0.05);
            border-radius: 8px;
            color: var(--footer-text);
            font-style: italic;
        }
        
        .history-container {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            padding: 25px;
            margin-top: 30px;
            border: 1px solid var(--border-color);
            box-shadow: var(--shadow);
        }
        
        .history-title {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            color: var(--secondary);
        }
        
        .history-list {
            max-height: 300px;
            overflow-y: auto;
        }
        
        .history-item {
            padding: 12px 15px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
        }
        
        .history-item:last-child {
            border-bottom: none;
        }
        
        .history-item:hover {
            background: rgba(52, 152, 219, 0.1);
        }
        
        .clear-history {
            background: var(--accent);
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
        }
        
        footer {
            text-align: center;
            padding: 30px 0;
            margin-top: 30px;
            color: var(--footer-text);
            border-top: 1px solid var(--border-color);
            background: var(--footer-bg);
            border-radius: var(--border-radius);
        }
        
        .disclaimer {
            background: rgba(231, 76, 60, 0.1);
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
            border: 1px solid rgba(231, 76, 60, 0.3);
            font-size: 0.9rem;
        }
        
        .export-options, .share-options .export-btn-group {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        .export-btn {
            padding: 10px 20px;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: var(--transition);
        }

        #exportPDF, #exportTXT, #exportCSV {
             background: var(--secondary);
        }

        #exportPDF:hover, #exportTXT:hover, #exportCSV:hover {
            background: var(--accent);
            transform: scale(1.05);
        }
        
        .ip-type-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            justify-content: center;
        }
        
        .ip-btn {
            padding: 10px 20px;
            border: 1px solid var(--border-color);
            border-radius: 5px;
            background: var(--input-bg);
            cursor: pointer;
            transition: var(--transition);
            font-weight: 600;
            color: var(--text-color);
        }
        
        .ip-btn.active {
            background: var(--secondary);
            color: white;
            border-color: var(--secondary);
        }
        
        .consent-banner {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--card-bg);
            padding: 20px;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
            display: none;
            flex-wrap: wrap;
            gap: 15px;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            border-top: 2px solid var(--secondary);
            animation: slideUp 0.5s ease;
        }
        
        .consent-text {
            flex: 1;
            max-width: 800px;
        }
        
        .consent-buttons {
            display: flex;
            gap: 10px;
        }
        
        .consent-btn {
            padding: 8px 20px;
            border-radius: 5px;
            cursor: pointer;
            border: none;
            font-weight: 600;
        }
        
        .consent-accept {
            background: var(--success);
            color: white;
        }
        
        .consent-reject {
            background: var(--accent);
            color: white;
        }
        
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideUp { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }
        
        @media (max-width: 768px) {
            header h1 { font-size: 2.2rem; }
            .action-buttons { grid-template-columns: 1fr; }
            .result-grid { grid-template-columns: 1fr; }
            .export-options, .share-options .export-btn-group { flex-direction: column; align-items: center; }
        }
        @media (max-width: 480px) {
            .calculator-card { padding: 20px; }
            header h1 { font-size: 1.8rem; }
            .ip-type-selector { flex-direction: column; }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="header-top">
                <h1>Professional IP Subnet Calculator</h1>
                <button class="theme-toggle" id="themeToggle"><i class="fas fa-moon"></i></button>
            </div>
            <p>Calculate subnet masks, network addresses, broadcast addresses, and usable host ranges</p>
        </header>
        
        <div class="ip-type-selector">
            <button class="ip-btn active" id="ipv4Btn">IPv4 Calculator</button>
            <button class="ip-btn" id="ipv6Btn">IPv6 Calculator (Demo)</button>
        </div>
        
        <main class="calculator-card">
            <h2 class="calculator-title">Subnet Calculation</h2>
            
            <div id="ipv4Form">
                <div class="input-row">
                    <div class="input-group">
                        <label for="ipv4Address"><i class="fas fa-network-wired"></i> IPv4 Address</label>
                        <input type="text" id="ipv4Address" placeholder="e.g., 192.168.1.1">
                    </div>
                    
                    <div class="input-group">
                        <label for="subnetMask"><i class="fas fa-mask"></i> Subnet Mask or CIDR</label>
                        <input type="text" id="subnetMask" placeholder="e.g., 255.255.255.0 or /24">
                    </div>
                </div>
            </div>
            
            <div id="ipv6Form" style="display: none;">
                <div class="input-row">
                    <div class="input-group">
                        <label for="ipv6Address"><i class="fas fa-network-wired"></i> IPv6 Address</label>
                        <input type="text" id="ipv6Address" placeholder="e.g., 2001:db8:85a3::8a2e:370:7334">
                    </div>
                    
                    <div class="input-group">
                        <label for="ipv6Prefix"><i class="fas fa-mask"></i> Prefix Length</label>
                        <input type="text" id="ipv6Prefix" placeholder="e.g., /64">
                    </div>
                </div>
                <div style="text-align:center; color: var(--warning); margin: 10px 0;"><i class="fas fa-exclamation-triangle"></i> The IPv6 calculator is for demonstration only and does not perform real calculations.</div>
            </div>
            
            <div class="action-buttons">
                <button class="btn btn-primary" id="calculate"><i class="fas fa-calculator"></i> Calculate</button>
                <button class="btn btn-secondary" id="reset"><i class="fas fa-redo"></i> Reset</button>
                <button class="btn btn-primary" id="example"><i class="fas fa-lightbulb"></i> Load Example</button>
            </div>
            
            <div class="result-container">
                <div class="result-grid">
                    <div class="result-item"><div class="result-label"><i class="fas fa-address-card"></i> Network Address</div><div class="result-value"><span id="networkAddress">-</span><button class="copy-btn" data-target="networkAddress"><i class="fas fa-copy"></i></button></div></div>
                    <div class="result-item"><div class="result-label"><i class="fas fa-mask"></i> Subnet Mask</div><div class="result-value"><span id="subnetResult">-</span><button class="copy-btn" data-target="subnetResult"><i class="fas fa-copy"></i></button></div></div>
                    <div class="result-item"><div class="result-label"><i class="fas fa-broadcast-tower"></i> Broadcast Address</div><div class="result-value"><span id="broadcastAddress">-</span><button class="copy-btn" data-target="broadcastAddress"><i class="fas fa-copy"></i></button></div></div>
                    <div class="result-item"><div class="result-label"><i class="fas fa-users"></i> Usable Host Range</div><div class="result-value"><span id="hostRange">-</span><button class="copy-btn" data-target="hostRange"><i class="fas fa-copy"></i></button></div></div>
                    <div class="result-item"><div class="result-label"><i class="fas fa-hashtag"></i> Total Hosts</div><div class="result-value"><span id="totalHosts">-</span></div></div>
                    <div class="result-item"><div class="result-label"><i class="fas fa-server"></i> Usable Hosts</div><div class="result-value"><span id="usableHosts">-</span></div></div>
                    <div class="result-item"><div class="result-label"><i class="fas fa-project-diagram"></i> IP Class</div><div class="result-value"><span id="ipClass">-</span></div></div>
                    <div class="result-item"><div class="result-label"><i class="fas fa-sitemap"></i> CIDR Notation</div><div class="result-value"><span id="cidrNotation">-</span><button class="copy-btn" data-target="cidrNotation"><i class="fas fa-copy"></i></button></div></div>
                </div>
            </div>
            
            <div class="export-options">
                <button class="export-btn" id="exportPDF"><i class="fas fa-file-pdf"></i> Export as PDF</button>
                <button class="export-btn" id="exportTXT"><i class="fas fa-file-alt"></i> Export as TXT</button>
                <button class="export-btn" id="exportCSV"><i class="fas fa-file-csv"></i> Export as CSV</button>
            </div>
            
            <div class="share-options">
                <h3 style="text-align: center; margin: 20px 0 15px; color: var(--secondary);">Share Results</h3>
                <div class="export-btn-group">
                    <button class="export-btn" style="background: #4267B2;" id="shareFB"><i class="fab fa-facebook"></i> Facebook</button>
                    <button class="export-btn" style="background: #1DA1F2;" id="shareTW"><i class="fab fa-twitter"></i> Twitter</button>
                    <button class="export-btn" style="background: #2867B2;" id="shareLI"><i class="fab fa-linkedin"></i> LinkedIn</button>
                    <button class="export-btn" style="background: #333;" id="copyLink"><i class="fas fa-link"></i> Copy Link</button>
                </div>
            </div>
            
            <div class="ad-container">
                <div class="ad-box"><div class="ad-label"><i class="fas fa-ad"></i> Adsterra Advertisement</div><div class="ad-content"><img src="https://via.placeholder.com/300x250?text=Adsterra+Ad" alt="Advertisement" style="max-width: 100%; height: auto; border-radius: 5px;"></div></div>
                <div class="ad-box"><div class="ad-label"><i class="fas fa-ad"></i> Yllix Advertisement</div><div class="ad-content"><img src="https://via.placeholder.com/300x250?text=Yllix+Ad" alt="Advertisement" style="max-width: 100%; height: auto; border-radius: 5px;"></div></div>
            </div>
        </main>
        
        <div class="history-container">
            <div class="history-title">
                <h3><i class="fas fa-history"></i> Calculation History</h3>
                <button class="clear-history" id="clearHistory">Clear History</button>
            </div>
            <div class="history-list" id="historyList"><!-- History items will be added here dynamically --></div>
        </div>
        
        <div class="disclaimer"><p><i class="fas fa-exclamation-triangle"></i> This calculator provides subnet information based on standard IP subnetting principles. For critical network configurations, always verify with network administrators.</p></div>
        <footer><p>© 2023 Professional IP Subnet Calculator | All Rights Reserved</p><p>Secure & Private | Adherence to GDPR/CCPA Standards</p></footer>
    </div>
    
    <div class="consent-banner" id="consentBanner">
        <div class="consent-text"><p>We use cookies and similar technologies to provide a better experience and display relevant ads. By clicking "Accept", you consent to our use of cookies and ad personalization as described in our Privacy Policy.</p></div>
        <div class="consent-buttons">
            <button class="consent-btn consent-accept" id="acceptConsent">Accept</button>
            <button class="consent-btn consent-reject" id="rejectConsent">Reject</button>
        </div>
    </div>

    <script>
        // DOM Elements
        const ipv4Btn = document.getElementById('ipv4Btn');
        const ipv6Btn = document.getElementById('ipv6Btn');
        const ipv4Form = document.getElementById('ipv4Form');
        const ipv6Form = document.getElementById('ipv6Form');
        const ipv4Address = document.getElementById('ipv4Address');
        const subnetMask = document.getElementById('subnetMask');
        const ipv6Address = document.getElementById('ipv6Address');
        const ipv6Prefix = document.getElementById('ipv6Prefix');
        const calculateBtn = document.getElementById('calculate');
        const resetBtn = document.getElementById('reset');
        const exampleBtn = document.getElementById('example');
        const themeToggle = document.getElementById('themeToggle');
        const exportPDF = document.getElementById('exportPDF');
        const exportCSV = document.getElementById('exportCSV');
        const exportTXT = document.getElementById('exportTXT');
        const clearHistoryBtn = document.getElementById('clearHistory');
        const historyList = document.getElementById('historyList');
        const consentBanner = document.getElementById('consentBanner');
        const acceptConsent = document.getElementById('acceptConsent');
        const rejectConsent = document.getElementById('rejectConsent');
        const copyBtns = document.querySelectorAll('.copy-btn');
        const shareBtns = {
            fb: document.getElementById('shareFB'),
            tw: document.getElementById('shareTW'),
            li: document.getElementById('shareLI'),
            link: document.getElementById('copyLink')
        };
        
        // Result elements
        const networkAddress = document.getElementById('networkAddress');
        const subnetResult = document.getElementById('subnetResult');
        const broadcastAddress = document.getElementById('broadcastAddress');
        const hostRange = document.getElementById('hostRange');
        const totalHosts = document.getElementById('totalHosts');
        const usableHosts = document.getElementById('usableHosts');
        const ipClass = document.getElementById('ipClass');
        const cidrNotation = document.getElementById('cidrNotation');
        
        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            initTheme();
            loadHistory();
            setupEventListeners();
            checkCookieConsent();
            checkSharedUrl();
            ipv4Address.focus();
        });

        function setupEventListeners() {
            ipv4Btn.addEventListener('click', () => switchIpVersion('ipv4'));
            ipv6Btn.addEventListener('click', () => switchIpVersion('ipv6'));
            calculateBtn.addEventListener('click', calculateSubnet);
            resetBtn.addEventListener('click', resetCalculator);
            exampleBtn.addEventListener('click', loadExample);
            themeToggle.addEventListener('click', toggleTheme);
            exportPDF.addEventListener('click', exportToPDF);
            exportCSV.addEventListener('click', exportToCSV);
            exportTXT.addEventListener('click', exportToTXT);
            clearHistoryBtn.addEventListener('click', clearHistory);
            acceptConsent.addEventListener('click', handleCookieConsent);
            rejectConsent.addEventListener('click', handleCookieConsent);
            
            copyBtns.forEach(btn => btn.addEventListener('click', copyToClipboard));

            shareBtns.fb.addEventListener('click', () => share('fb'));
            shareBtns.tw.addEventListener('click', () => share('tw'));
            shareBtns.li.addEventListener('click', () => share('li'));
            shareBtns.link.addEventListener('click', () => share('link'));
        }
        
        // Theme
        function initTheme() {
            const savedTheme = localStorage.getItem('theme') || (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
            if (savedTheme === 'dark') {
                document.body.classList.add('dark-mode');
                themeToggle.innerHTML = '<i class="fas fa-sun"></i>';
            } else {
                themeToggle.innerHTML = '<i class="fas fa-moon"></i>';
            }
        }
        
        function toggleTheme() {
            document.body.classList.toggle('dark-mode');
            const isDark = document.body.classList.contains('dark-mode');
            localStorage.setItem('theme', isDark ? 'dark' : 'light');
            themeToggle.innerHTML = isDark ? '<i class="fas fa-sun"></i>' : '<i class="fas fa-moon"></i>';
        }
        
        // Cookie Consent
        function checkCookieConsent() {
            if (!localStorage.getItem('cookieConsent')) {
                consentBanner.style.display = 'flex';
            }
        }
        function handleCookieConsent(e) {
            localStorage.setItem('cookieConsent', e.target === acceptConsent ? 'accepted' : 'rejected');
            consentBanner.style.display = 'none';
        }

        function checkSharedUrl() {
            const params = new URLSearchParams(window.location.search);
            const ip = params.get('ip');
            const mask = params.get('mask');
            if(ip && mask) {
                ipv4Address.value = ip;
                subnetMask.value = mask;
                calculateSubnet();
            }
        }
        
        function switchIpVersion(version) {
            const isActive = version === 'ipv4';
            ipv4Btn.classList.toggle('active', isActive);
            ipv6Btn.classList.toggle('active', !isActive);
            ipv4Form.style.display = isActive ? 'block' : 'none';
            ipv6Form.style.display = isActive ? 'none' : 'block';
            resetCalculator();
        }
        
        function calculateSubnet() {
            ipv4Btn.classList.contains('active') ? calculateIPv4() : calculateIPv6();
        }

        function calculateIPv4() {
            const ip = ipv4Address.value.trim();
            const maskInput = subnetMask.value.trim();

            if (!isValidIPv4(ip) || !isValidSubnetMask(maskInput)) {
                alert('Please enter a valid IPv4 address and subnet mask (e.g., 255.255.255.0 or /24)');
                return;
            }
            
            const cidr = maskInput.startsWith('/') ? parseInt(maskInput.substring(1)) : subnetMaskToCIDR(maskInput);
            if (isNaN(cidr)) {
                alert('Invalid CIDR value in subnet mask.');
                return;
            }

            const ipLong = ipToLong(ip);
            const maskLong = cidrToMaskLong(cidr);
            const networkLong = ipLong & maskLong;
            const broadcastLong = networkLong | (~maskLong >>> 0);
            
            const hostBits = 32 - cidr;
            const total = hostBits > 0 ? Math.pow(2, hostBits) : 1;
            const usable = total >= 2 ? total - 2 : 0;
            
            // Update UI
            networkAddress.textContent = longToIp(networkLong);
            subnetResult.textContent = longToIp(maskLong);
            broadcastAddress.textContent = longToIp(broadcastLong);
            hostRange.textContent = usable > 0 ? `${longToIp(networkLong + 1)} - ${longToIp(broadcastLong - 1)}` : 'N/A';
            totalHosts.textContent = total.toLocaleString();
            usableHosts.textContent = usable.toLocaleString();
            ipClass.textContent = getIPv4Class(ip);
            cidrNotation.textContent = `/${cidr}`;
            
            addToHistory(ip, maskInput);
        }

        // --- Core IPv4 Calculation Helpers ---
        function ipToLong(ip) {
            return ip.split('.').reduce((acc, octet) => (acc << 8) + parseInt(octet, 10), 0) >>> 0;
        }

        function longToIp(long) {
            return [(long >>> 24) & 255, (long >>> 16) & 255, (long >>> 8) & 255, long & 255].join('.');
        }

        function cidrToMaskLong(cidr) {
            return (-1 << (32 - cidr)) >>> 0;
        }

        function subnetMaskToCIDR(mask) {
            const binary = ipToLong(mask).toString(2);
            return (binary.match(/1/g) || []).length;
        }
        
        function isValidIPv4(ip) {
            return /^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/.test(ip);
        }
        
        function isValidSubnetMask(mask) {
            if (mask.startsWith('/')) {
                const cidr = parseInt(mask.substring(1));
                return !isNaN(cidr) && cidr >= 0 && cidr <= 32;
            }
            if (!isValidIPv4(mask)) return false;
            const long = ipToLong(mask);
            const inverted = (~long >>> 0);
            return (inverted & (inverted + 1)) === 0;
        }

        function getIPv4Class(ip) {
            const firstOctet = parseInt(ip.split('.')[0], 10);
            if (firstOctet >= 1 && firstOctet <= 126) return 'A';
            if (firstOctet >= 128 && firstOctet <= 191) return 'B';
            if (firstOctet >= 192 && firstOctet <= 223) return 'C';
            if (firstOctet >= 224 && firstOctet <= 239) return 'D (Multicast)';
            return 'E (Experimental)';
        }

        // Placeholder for IPv6 calculation
        function calculateIPv6() {
            // This remains a placeholder as a full implementation is complex.
            networkAddress.textContent = "2001:db8:85a3::/64";
            subnetResult.textContent = "ffff:ffff:ffff:ffff::";
            broadcastAddress.textContent = "Not applicable";
            hostRange.textContent = "::1 to ...ffff";
            totalHosts.textContent = "~1.84 x 10¹⁹";
            usableHosts.textContent = "~1.84 x 10¹⁹";
            ipClass.textContent = "N/A";
            cidrNotation.textContent = ipv6Prefix.value || '/64';
            addToHistory(ipv6Address.value, ipv6Prefix.value);
        }
        
        // History functions
        function addToHistory(ip, mask) {
            if (!ip || !mask) return;
            const history = JSON.parse(localStorage.getItem('subnetHistory') || '[]');
            const entry = { ip, mask, timestamp: new Date().toISOString(), type: ipv4Btn.classList.contains('active') ? 'ipv4' : 'ipv6' };
            const existingIndex = history.findIndex(h => h.ip === ip && h.mask === mask);
            if (existingIndex > -1) history.splice(existingIndex, 1);
            history.unshift(entry);
            localStorage.setItem('subnetHistory', JSON.stringify(history.slice(0, 10)));
            loadHistory();
        }
        
        function loadHistory() {
            const history = JSON.parse(localStorage.getItem('subnetHistory') || '[]');
            historyList.innerHTML = history.length === 0 ? '<div class="history-item">No history yet</div>' 
                : history.map(entry => `
                    <div class="history-item" data-ip="${entry.ip}" data-mask="${entry.mask}" data-type="${entry.type}">
                        <div><strong>${entry.ip}</strong> / ${entry.mask} <small>(${entry.type})</small></div>
                        <div>${new Date(entry.timestamp).toLocaleTimeString()}</div>
                    </div>`).join('');
            
            document.querySelectorAll('.history-item[data-ip]').forEach(item => {
                item.addEventListener('click', (e) => {
                    const el = e.currentTarget;
                    switchIpVersion(el.dataset.type);
                    if(el.dataset.type === 'ipv4'){
                        ipv4Address.value = el.dataset.ip;
                        subnetMask.value = el.dataset.mask;
                    } else {
                        ipv6Address.value = el.dataset.ip;
                        ipv6Prefix.value = el.dataset.mask;
                    }
                    calculateSubnet();
                });
            });
        }
        
        function clearHistory() {
            localStorage.removeItem('subnetHistory');
            loadHistory();
        }
        
        function resetCalculator() {
            ipv4Address.value = ''; subnetMask.value = '';
            ipv6Address.value = ''; ipv6Prefix.value = '';
            
            [networkAddress, subnetResult, broadcastAddress, hostRange, totalHosts, usableHosts, ipClass, cidrNotation]
                .forEach(el => el.textContent = '-');
            
            ipv4Address.focus();
        }
        
        function loadExample() {
            if (ipv4Btn.classList.contains('active')) {
                ipv4Address.value = '192.168.10.55';
                subnetMask.value = '/26';
            } else {
                ipv6Address.value = '2001:db8:85a3::8a2e:370:7334';
                ipv6Prefix.value = '/64';
            }
            calculateSubnet();
        }
        
        function copyToClipboard(e) {
            const btn = e.currentTarget;
            const text = document.getElementById(btn.dataset.target).textContent;
            navigator.clipboard.writeText(text).then(() => {
                const originalHTML = btn.innerHTML;
                btn.innerHTML = '<i class="fas fa-check"></i> Done';
                setTimeout(() => { btn.innerHTML = originalHTML; }, 2000);
            });
        }
        
        // Export & Share
        function generateShareLink() {
            if (!ipv4Address.value || !subnetMask.value) return null;
            const url = new URL(window.location.href);
            url.searchParams.set('ip', ipv4Address.value);
            url.searchParams.set('mask', subnetMask.value);
            return url.toString();
        }

        function share(platform) {
            const shareUrl = generateShareLink();
            if (!shareUrl) {
                alert('Please calculate a result first before sharing.');
                return;
            }

            const text = `Check out this subnet calculation for ${ipv4Address.value}${cidrNotation.textContent}`;
            const encodedUrl = encodeURIComponent(shareUrl);
            const encodedText = encodeURIComponent(text);

            let link;
            if (platform === 'fb') link = `https://www.facebook.com/sharer/sharer.php?u=${encodedUrl}`;
            else if (platform === 'tw') link = `https://twitter.com/intent/tweet?url=${encodedUrl}&text=${encodedText}`;
            else if (platform === 'li') link = `https://www.linkedin.com/shareArticle?mini=true&url=${encodedUrl}&title=${encodedText}`;
            else if (platform === 'link') {
                navigator.clipboard.writeText(shareUrl).then(() => alert('Shareable link copied to clipboard!'));
                return;
            }

            window.open(link, '_blank', 'width=600,height=400');
        }

        function getResultsAsText() {
            return [
                `IP Address: ${ipv4Address.value}`, `Subnet Input: ${subnetMask.value}`, '',
                `Network Address: ${networkAddress.textContent}`, `Subnet Mask: ${subnetResult.textContent}`,
                `Broadcast Address: ${broadcastAddress.textContent}`, `Usable Host Range: ${hostRange.textContent}`,
                `Total Hosts: ${totalHosts.textContent}`, `Usable Hosts: ${usableHosts.textContent}`,
                `IP Class: ${ipClass.textContent}`, `CIDR Notation: ${cidrNotation.textContent}`
            ].join('\n');
        }

        function exportToPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            doc.setFontSize(22);
            doc.setTextColor(41, 128, 185);
            // CORRECTED: use modern jsPDF syntax
            doc.text('IP Subnet Calculation Result', 105, 20, { align: 'center' });
            
            doc.setFontSize(12);
            doc.setTextColor(0, 0, 0);
            doc.text(getResultsAsText(), 20, 40);
            
            doc.setFontSize(10);
            doc.setTextColor(127, 140, 141);
            doc.text('Generated by Professional IP Subnet Calculator', 105, 280, { align: 'center' });
            
            doc.save('subnet-calculation.pdf');
        }
        
        function exportToTXT() {
            const txtContent = "IP SUBNET CALCULATION RESULT\n==============================\n\n" + getResultsAsText();
            const blob = new Blob([txtContent], { type: 'text/plain' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = 'subnet-calculation.txt';
            link.click();
            URL.revokeObjectURL(link.href);
        }
        
        function exportToCSV() {
            let csvContent = "Parameter,Value\n";
            getResultsAsText().split('\n').forEach(line => {
                const parts = line.split(': ');
                if (parts.length === 2) {
                    csvContent += `"${parts[0]}","${parts[1]}"\n`;
                }
            });
            const encodedUri = 'data:text/csv;charset=utf-8,' + encodeURIComponent(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", "subnet-calculation.csv");
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }
    </script>
</body>
</html>